import TelegramBot from 'node-telegram-bot-api';
import { paramParser } from '../middleware/paramParser.js';
import { telegramBot } from '../server.js';
import { addNewUser } from './UserController.js';

interface StartCommandType {
    (msg: TelegramBot.Message, match?: RegExpExecArray | null): void;
}

export const handlerStartCommandWithParams: StartCommandType = async (msg, match) => {
    try {
        console.log('start');
        const queryData = await paramParser(match!);

        const chatId = msg.chat.id;
        console.log(chatId);

        await addNewUser(msg, queryData);
        await telegramBot.sendMessage(
            chatId,
            'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\n \nü•ë –≠—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–æ–≤ –∏ —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä–æ–≤.\n \n‚è± –° –Ω–∞—à–∏–º –±–æ—Ç–æ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, —É–¥–µ–ª—è—è —ç—Ç–æ–º—É –≤ –¥–µ—Å—è—Ç–∫–∏ —Ä–∞–∑ –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—è –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ.\n \nüß† –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –µ—Å—Ç—å 2 –±–æ—Ç–∞:\n \nü•ë –ë–æ—Ç-–Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥. –û—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –≤ —Å—Ñ–µ—Ä–µ –Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∏–∏ –∏ –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è. –°–æ—Å—Ç–∞–≤–∏—Ç —Ä–∞—Ü–∏–æ–Ω, —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –ö–ë–ñ–£, –Ω–∞–π–¥–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª—é–±–æ–º –ø—Ä–æ–¥—É–∫—Ç–µ –∏ –ø–æ–º–æ–∂–µ—Ç —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç—ã –∏–∑ –Ω–∏—Ö. \n \nüñå –ë–æ—Ç-–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä. –ó–∞ –≤–∞—Å –Ω–∞–ø–∏—à–µ—Ç –ª—é–±–æ–π —Ç–µ–∫—Å—Ç –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É –≤ –Ω—É–∂–Ω–æ–π –≤–∞–º —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–µ. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç–∞—Ç—å—è –≤ –±–ª–æ–≥, —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–ª–∏ —Ä–∞—Å—Å—ã–ª–∫–∏, —Ç–∞–∫ –∂–µ –ø–æ–¥—Å–∫–∞–∂–µ—Ç –∏–¥–µ–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –æ—à–∏–±–∫–∏ –∏ —Å—Ç–∏–ª–∏—Å—Ç–∏–∫—É. \n \n üéÅ  ‚¨áÔ∏è –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ —Å –±–æ—Ç–æ–º-—ç–∫—Å–ø–µ—Ä—Ç–æ–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É "Open"',
        );
    } catch (error) {
        console.log(error);
    }
};
export const handlerStartCommand: StartCommandType = async (msg) => {
    try {
        await addNewUser(msg);
        const chatId = msg.chat.id;

        const message =
            '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å. –Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–∞—é—â–µ–µ, SEO-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, —Å–æ–±—Ä–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (https://telegra.ph/Instrukciya-03-23-8)\n\n –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:';
        const options = {
            reply_markup: {
                inline_keyboard: [
                    [{ text: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞', callback_data: 'description' }],
                    [{ text: '–°–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤', callback_data: 'seo' }],
                    [{ text: '–í–∞—Ä–∏–∞–Ω—Ç—ã –∏–º–µ–Ω –¥–ª—è –±—Ä–µ–Ω–¥–∞', callback_data: 'brend' }],
                    [{ text: '–í–∞—Ä–∏–∞–Ω—Ç—ã —Å–µ—Ç–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞', callback_data: 'sets' }],
                ],
                resize_keyboard: true,
            },
        };
        telegramBot.sendMessage(chatId, message, options);
    } catch (error) {}
};
